
# Coordinación

## Por que estudiamos?

Nos tenemos que poner de acuerdo en como se decide cual es la verdad en caso de consistencia.

Esta es solo un motivo.

Necesitamos que los nodos cooperen correctamente, necesarias para evitar conflictos o errores porque buscamos mantener consistencia.

El tic de un sistema es arbitrario. El tic se define en cuantas oscilaciones entran en esa medida.

### Relojes atómicos

son los que tienen un desfazaje despreciable. Con UTC tenemos un montón de antenas que informan mediante pulsaciones cada segundo que pasa.

### Sincronización de relojes

**Precisión** es diferencia o desfazaje entre 2 procesos mientras que **exactitud** corresponde al desfazaje de una computadora vs el tiempo real.

Lo importante es mantener precisión para coordinar las computadoras.

### NTP

Entre que le pregunto al server y vuelve, por comunicación puede haber un delay. Hay un mecanismo de estimación de cuanto es el offset.

**Estrato**: que tan confiable es el sistema con el que valido el horario, que tan confiable es la fuente.

Estrato 0 es el reloj en si, es por ejemplo el reloj atomico o UTC. Estrato 1 es el servidor que se arma encima de ese reloj. De ahi en adelante es 2, 3, 4, etc.

### Reloj lógico

Te ordenas de manera lógica, no real, en función a eventos. Con estar de acuerdo en el orden de los eventos, es suficiente. De esta forma, no hay duda entre los procesos del orden correcto. Nos desacoplamos del tiempo, nos aseguramos que estamos de acuerdo con el orden de los eventos.

**Lamport** plantea principios:

- Si dos procesos no interactúan no es necesario coordinarlos. No importa el orden lógico de los otros procesos, solo me importa que ocurran.
- Si es importante el a happens-before b.
    - Si dos eventos ocurren en un proceso y a ocurre antes que b, es obvio.
    - Si nos comunicamos entre procesos, la forma que tenemos para saber el orden es mediante la emisión del mensaje. Si yo envío el mensaje en t1, se que la recepción si o si será en t2 > t1.

Con esta base de que un mensaje si o si tiene que llegar después, podemos organizar los procesos. De esta forma, podemos ajustar los relojes lógicos entre procesos haciendo t1 + 1 en caso de que t1 > t2.

### Reloj de vectores

Aparece porque lamport necesita linealidad.

Hay un vector con n posiciones, siendo n la cantidad de procesos. En la posicion del vector que correponde al evento, se tiene un contador de eventos del proceso.

El vector nos puede servir para trazar causalidad, no es garantía.

## Exclusión mutua

### Solución centralizada

Hay un coordinador al que le pido acceso a un recurso. Ya empezamos a hablar de un coordinador.

### Algoritmo de elección

Tenemos todos nodos peer, todos tienen el mismo código. De alguna forma tenemos que identificar cual va a ser el nodo coordinador.